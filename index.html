<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D DM Toolkit</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/statblock.css">
    <link rel="stylesheet" href="css/npc-card.css">
    <link rel="stylesheet" href="css/loot-card.css">
    <link rel="stylesheet" href="css/hook-card.css">
    <link rel="stylesheet" href="css/location-card.css">
    <link rel="stylesheet" href="css/item-card.css">
    <link rel="stylesheet" href="css/canvas.css">
    <link rel="stylesheet" href="css/vtt.css">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Scaly+Sans&display=swap" rel="stylesheet">
</head>
<body>
    <div class="toolkit-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">DM Toolkit</h1>
                <button type="button" class="sidebar-toggle" id="sidebar-toggle" title="Toggle Sidebar">
                    <span>&#9776;</span>
                </button>
            </div>
            <ul class="sidebar-nav">
                <li class="nav-item active" data-panel="monster">
                    <span class="nav-icon">&#128009;</span>
                    <span class="nav-label">Monster</span>
                </li>
                <li class="nav-item" data-panel="npc">
                    <span class="nav-icon">&#128100;</span>
                    <span class="nav-label">NPC</span>
                </li>
                <li class="nav-item" data-panel="loot">
                    <span class="nav-icon">&#128176;</span>
                    <span class="nav-label">Loot</span>
                </li>
                <li class="nav-item" data-panel="hooks">
                    <span class="nav-icon">&#128220;</span>
                    <span class="nav-label">Hooks</span>
                </li>
                <li class="nav-item" data-panel="location">
                    <span class="nav-icon">&#127984;</span>
                    <span class="nav-label">Location</span>
                </li>
                <li class="nav-item" data-panel="item">
                    <span class="nav-icon">&#9876;</span>
                    <span class="nav-label">Item</span>
                </li>
                <li class="nav-divider"></li>
                <li class="nav-item" data-panel="library">
                    <span class="nav-icon">&#128218;</span>
                    <span class="nav-label">Library</span>
                </li>
                <li class="nav-item" data-panel="campaign">
                    <span class="nav-icon">&#128203;</span>
                    <span class="nav-label">Campaign</span>
                </li>
                <li class="nav-item" data-panel="vtt">
                    <span class="nav-icon">&#127918;</span>
                    <span class="nav-label">VTT</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <span class="version">v2.0</span>
            </div>
        </nav>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- ==================== MONSTER GENERATOR PANEL ==================== -->
            <div id="panel-monster" class="generator-panel active">
                <div class="app-container">
                    <!-- Left Panel - Generator Controls -->
                    <aside class="control-panel">
                        <header class="controls-header" id="monster-panel-toggle">
                            <h2>Monster Generator</h2>
                            <span class="toggle-indicator">&#9660;</span>
                        </header>

                        <div class="controls-content" id="monster-panel-content">
                        <div class="button-group button-group-top">
                            <button type="button" id="randomize-btn" class="btn btn-secondary">
                                <span class="dice-icon">&#9858;</span> Randomize
                            </button>
                            <button type="button" id="generate-btn" class="btn btn-primary">
                                Generate
                            </button>
                        </div>

                        <div class="control-section">
                            <label for="monster-name">Monster Name</label>
                            <div class="input-group">
                                <input type="text" id="monster-name" placeholder="Enter name or generate...">
                                <button type="button" id="auto-name-btn" class="btn-icon" title="Generate Name">
                                    <span class="dice-icon">&#9858;</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-section">
                            <label for="monster-type">Monster Type</label>
                            <div class="input-group">
                                <select id="monster-type">
                                    <option value="">Select Type...</option>
                                    <option value="aberration">Aberration</option>
                                    <option value="beast">Beast</option>
                                    <option value="celestial">Celestial</option>
                                    <option value="construct">Construct</option>
                                    <option value="dragon">Dragon</option>
                                    <option value="elemental">Elemental</option>
                                    <option value="fey">Fey</option>
                                    <option value="fiend">Fiend</option>
                                    <option value="giant">Giant</option>
                                    <option value="humanoid">Humanoid</option>
                                    <option value="monstrosity">Monstrosity</option>
                                    <option value="ooze">Ooze</option>
                                    <option value="plant">Plant</option>
                                    <option value="undead">Undead</option>
                                </select>
                                <button type="button" id="lock-type-btn" class="btn-icon btn-lock" title="Lock Monster Type">
                                    <span class="lock-icon">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                            <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                                        </svg>
                                    </span>
                                </button>
                            </div>
                        </div>

                        <!-- Humanoid Options (conditionally shown, placed under monster type) -->
                        <div id="humanoid-options" class="humanoid-section" style="display: none;">
                            <div class="section-divider">
                                <span>Humanoid Options</span>
                            </div>

                            <div class="control-section">
                                <label for="humanoid-race">Race</label>
                                <select id="humanoid-race">
                                    <option value="">Select Race...</option>
                                    <optgroup label="Common Races">
                                        <option value="human">Human</option>
                                        <option value="dwarf-hill">Dwarf (Hill)</option>
                                        <option value="dwarf-mountain">Dwarf (Mountain)</option>
                                        <option value="elf-high">Elf (High)</option>
                                        <option value="elf-wood">Elf (Wood)</option>
                                        <option value="elf-drow">Elf (Drow)</option>
                                        <option value="halfling-lightfoot">Halfling (Lightfoot)</option>
                                        <option value="halfling-stout">Halfling (Stout)</option>
                                        <option value="gnome-forest">Gnome (Forest)</option>
                                        <option value="gnome-rock">Gnome (Rock)</option>
                                        <option value="half-elf">Half-Elf</option>
                                        <option value="half-orc">Half-Orc</option>
                                        <option value="tiefling">Tiefling</option>
                                        <option value="dragonborn">Dragonborn</option>
                                    </optgroup>
                                    <optgroup label="Uncommon Races">
                                        <option value="aasimar">Aasimar</option>
                                        <option value="genasi-air">Genasi (Air)</option>
                                        <option value="genasi-earth">Genasi (Earth)</option>
                                        <option value="genasi-fire">Genasi (Fire)</option>
                                        <option value="genasi-water">Genasi (Water)</option>
                                        <option value="goliath">Goliath</option>
                                        <option value="firbolg">Firbolg</option>
                                        <option value="kenku">Kenku</option>
                                        <option value="lizardfolk">Lizardfolk</option>
                                        <option value="tabaxi">Tabaxi</option>
                                        <option value="triton">Triton</option>
                                        <option value="tortle">Tortle</option>
                                        <option value="aarakocra">Aarakocra</option>
                                        <option value="warforged">Warforged</option>
                                        <option value="changeling">Changeling</option>
                                        <option value="kalashtar">Kalashtar</option>
                                        <option value="shifter">Shifter</option>
                                    </optgroup>
                                    <optgroup label="Monstrous Races">
                                        <option value="gnoll">Gnoll</option>
                                        <option value="bugbear">Bugbear</option>
                                        <option value="goblin">Goblin</option>
                                        <option value="hobgoblin">Hobgoblin</option>
                                        <option value="kobold">Kobold</option>
                                        <option value="orc">Orc</option>
                                        <option value="yuan-ti">Yuan-ti</option>
                                        <option value="duergar">Duergar</option>
                                        <option value="githyanki">Githyanki</option>
                                        <option value="githzerai">Githzerai</option>
                                        <option value="kuo-toa">Kuo-toa</option>
                                        <option value="sahuagin">Sahuagin</option>
                                        <option value="thri-kreen">Thri-kreen</option>
                                        <option value="bullywug">Bullywug</option>
                                        <option value="grung">Grung</option>
                                        <option value="myconid">Myconid</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div class="control-section">
                                <label for="humanoid-class">Class</label>
                                <select id="humanoid-class">
                                    <option value="">No Class (Commoner)</option>
                                    <option value="barbarian">Barbarian</option>
                                    <option value="bard">Bard</option>
                                    <option value="cleric">Cleric</option>
                                    <option value="druid">Druid</option>
                                    <option value="fighter">Fighter</option>
                                    <option value="monk">Monk</option>
                                    <option value="paladin">Paladin</option>
                                    <option value="ranger">Ranger</option>
                                    <option value="rogue">Rogue</option>
                                    <option value="sorcerer">Sorcerer</option>
                                    <option value="warlock">Warlock</option>
                                    <option value="wizard">Wizard</option>
                                    <option value="artificer">Artificer</option>
                                </select>
                            </div>

                            <div class="checkbox-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="generate-inventory" checked>
                                    <span>Generate Inventory</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="include-magic-items">
                                    <span>Include Magic Items</span>
                                </label>
                            </div>
                        </div>

                        <div class="control-section">
                            <label for="challenge-rating">Challenge Rating</label>
                            <div class="input-group">
                                <select id="challenge-rating">
                                    <option value="0">0 (10 XP)</option>
                                    <option value="0.125">1/8 (25 XP)</option>
                                    <option value="0.25">1/4 (50 XP)</option>
                                    <option value="0.5">1/2 (100 XP)</option>
                                    <option value="1">1 (200 XP)</option>
                                    <option value="2">2 (450 XP)</option>
                                    <option value="3">3 (700 XP)</option>
                                    <option value="4">4 (1,100 XP)</option>
                                    <option value="5" selected>5 (1,800 XP)</option>
                                    <option value="6">6 (2,300 XP)</option>
                                    <option value="7">7 (2,900 XP)</option>
                                    <option value="8">8 (3,900 XP)</option>
                                    <option value="9">9 (5,000 XP)</option>
                                    <option value="10">10 (5,900 XP)</option>
                                    <option value="11">11 (7,200 XP)</option>
                                    <option value="12">12 (8,400 XP)</option>
                                    <option value="13">13 (10,000 XP)</option>
                                    <option value="14">14 (11,500 XP)</option>
                                    <option value="15">15 (13,000 XP)</option>
                                    <option value="16">16 (15,000 XP)</option>
                                    <option value="17">17 (18,000 XP)</option>
                                    <option value="18">18 (20,000 XP)</option>
                                    <option value="19">19 (22,000 XP)</option>
                                    <option value="20">20 (25,000 XP)</option>
                                    <option value="21">21 (33,000 XP)</option>
                                    <option value="22">22 (41,000 XP)</option>
                                    <option value="23">23 (50,000 XP)</option>
                                    <option value="24">24 (62,000 XP)</option>
                                    <option value="25">25 (75,000 XP)</option>
                                    <option value="26">26 (90,000 XP)</option>
                                    <option value="27">27 (105,000 XP)</option>
                                    <option value="28">28 (120,000 XP)</option>
                                    <option value="29">29 (135,000 XP)</option>
                                    <option value="30">30 (155,000 XP)</option>
                                </select>
                                <button type="button" id="lock-cr-btn" class="btn-icon btn-lock" title="Lock Challenge Rating">
                                    <span class="lock-icon">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                            <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                                        </svg>
                                    </span>
                                </button>
                            </div>
                        </div>

                        <div class="control-section">
                            <label for="size">Size</label>
                            <select id="size">
                                <option value="tiny">Tiny</option>
                                <option value="small">Small</option>
                                <option value="medium" selected>Medium</option>
                                <option value="large">Large</option>
                                <option value="huge">Huge</option>
                                <option value="gargantuan">Gargantuan</option>
                            </select>
                        </div>

                        <div class="control-section">
                            <label for="alignment">Alignment</label>
                            <select id="alignment">
                                <option value="any">Any Alignment</option>
                                <option value="unaligned">Unaligned</option>
                                <option value="lawful good">Lawful Good</option>
                                <option value="neutral good">Neutral Good</option>
                                <option value="chaotic good">Chaotic Good</option>
                                <option value="lawful neutral">Lawful Neutral</option>
                                <option value="true neutral" selected>True Neutral</option>
                                <option value="chaotic neutral">Chaotic Neutral</option>
                                <option value="lawful evil">Lawful Evil</option>
                                <option value="neutral evil">Neutral Evil</option>
                                <option value="chaotic evil">Chaotic Evil</option>
                            </select>
                        </div>

                        <fieldset class="control-section checkbox-group">
                            <legend>Attack Types</legend>
                            <div class="checkbox-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="attack-melee" checked>
                                    <span>Melee</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="attack-ranged">
                                    <span>Ranged</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="attack-spells">
                                    <span>Spellcasting</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="attack-breath">
                                    <span>Breath Weapon</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="attack-gaze">
                                    <span>Gaze Attack</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="attack-aura">
                                    <span>Aura Effect</span>
                                </label>
                            </div>
                        </fieldset>

                        <fieldset class="control-section checkbox-group">
                            <legend>Special Actions</legend>
                            <div class="checkbox-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="legendary-actions">
                                    <span>Legendary Actions</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="mythic-actions">
                                    <span>Mythic Actions</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="lair-actions">
                                    <span>Lair Actions</span>
                                </label>
                            </div>
                        </fieldset>

                        </div><!-- end panel-content -->
                    </aside>

                    <!-- Right Panel - Statblock Display -->
                    <main class="statblock-panel">
                        <div class="statblock-container">
                            <div id="statblock" class="statblock">
                                <div class="statblock-placeholder">
                                    <p>Configure options and click <strong>Generate</strong> to create a monster stat block.</p>
                                    <p>Or click <strong>Randomize</strong> for a random monster!</p>
                                </div>
                            </div>
                        </div>
                        <div class="monster-actions">
                            <button type="button" id="edit-btn" class="btn-icon" disabled title="Edit Monster">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button type="button" id="save-btn" class="btn-icon" disabled title="Save to Library">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </button>
                            <button type="button" id="export-json-btn" class="btn-icon" disabled title="Export JSON">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="12" y1="18" x2="12" y2="12"></line>
                                    <line x1="9" y1="15" x2="15" y2="15"></line>
                                </svg>
                            </button>
                            <button type="button" id="download-btn" class="btn-icon" disabled title="Download PNG">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </button>
                            <button type="button" id="canvas-btn" class="btn-icon" disabled title="Send to Canvas">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="12" y1="8" x2="12" y2="16"></line>
                                    <line x1="8" y1="12" x2="16" y2="12"></line>
                                </svg>
                            </button>
                            <button type="button" id="library-btn" class="btn-icon" title="Monster Library">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                </svg>
                            </button>
                        </div>
                    </main>
                </div>
            </div>

            <!-- ==================== NPC GENERATOR PANEL ==================== -->
            <div id="panel-npc" class="generator-panel">
                <div class="npc-panel-layout">
                    <!-- NPC Controls -->
                    <aside class="npc-controls">
                        <header class="controls-header" id="npc-panel-toggle">
                            <h2>NPC Generator</h2>
                            <span class="toggle-indicator">&#9660;</span>
                        </header>
                        <div class="controls-content" id="npc-panel-content">
                        <!-- Gender and Race Row -->
                        <div class="npc-control-row">
                            <div class="npc-control-group">
                                <label for="npcGender">Gender</label>
                                <select id="npcGender">
                                    <option value="random">Random</option>
                                </select>
                            </div>
                            <div class="npc-control-group">
                                <label for="npcRaceSelect">Race</label>
                                <select id="npcRaceSelect">
                                    <option value="random">Random</option>
                                </select>
                            </div>
                        </div>

                        <!-- Wealth Level -->
                        <div class="npc-control-group">
                            <label for="npcWealth">Wealth / Social Class</label>
                            <select id="npcWealth">
                                <option value="random">Random</option>
                            </select>
                        </div>

                        <!-- Vocation Type and Specific Vocation -->
                        <div class="npc-control-group">
                            <label for="npcVocationType">Vocation Type</label>
                            <select id="npcVocationType">
                                <option value="random">Random</option>
                            </select>
                        </div>

                        <div class="npc-control-group">
                            <label for="npcVocation">Specific Vocation</label>
                            <select id="npcVocation" disabled>
                                <option value="random">Random</option>
                            </select>
                        </div>

                        <!-- Generate Buttons -->
                        <button type="button" class="npc-generate-btn" onclick="NPCPanel.generate()">
                            Generate NPC
                        </button>
                        <button type="button" class="npc-surprise-btn" onclick="NPCPanel.generateSurpriseMe()">
                            Surprise Me
                        </button>

                        <!-- NPC Library -->
                        <div class="npc-library-section">
                            <h3>Saved NPCs</h3>
                            <div id="npcLibraryList" class="npc-library-list">
                                <div class="npc-library-empty">
                                    No saved NPCs yet
                                </div>
                            </div>
                        </div>
                        </div><!-- /.controls-content -->
                    </aside>

                    <!-- NPC Output -->
                    <div class="npc-output">
                        <div id="npcOutput" class="npc-output-inner">
                            <div class="npc-empty-state">
                                <div class="icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                </div>
                                <h3>No NPC Generated</h3>
                                <p>Click "Generate NPC" to create a new character</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== LOOT GENERATOR PANEL ==================== -->
            <div id="panel-loot" class="generator-panel">
                <div class="loot-panel-layout">
                    <!-- Loot Controls -->
                    <div class="loot-controls">
                        <header class="controls-header" id="loot-panel-toggle">
                            <h2>Loot Generator</h2>
                            <span class="toggle-indicator">&#9660;</span>
                        </header>
                        <div class="controls-content" id="loot-panel-content">
                        <div class="loot-control-group">
                            <label for="lootHoardType">Hoard Type</label>
                            <select id="lootHoardType">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="loot-control-row">
                            <div class="loot-control-group">
                                <label for="lootPartyLevel">Party Level</label>
                                <input type="number" id="lootPartyLevel" min="1" max="20" value="5">
                            </div>
                            <div class="loot-control-group">
                                <label for="lootPartySize">Party Size</label>
                                <input type="number" id="lootPartySize" min="1" max="10" value="4">
                            </div>
                        </div>

                        <button type="button" class="loot-generate-btn" onclick="LootPanel.generate()">
                            Generate Loot
                        </button>

                        <div class="loot-options">
                            <label class="loot-option">
                                <input type="checkbox" id="lootShowTags" checked onchange="LootPanel.updateOptions()">
                                <span>Show item tags</span>
                            </label>
                            <label class="loot-option">
                                <input type="checkbox" id="lootShowValues" checked onchange="LootPanel.updateOptions()">
                                <span>Show gold values</span>
                            </label>
                        </div>

                        <!-- Saved Loot Library -->
                        <div class="loot-library-section">
                            <h3>Saved Loot</h3>
                            <div id="lootLibraryList" class="loot-library-list">
                                <div class="loot-library-empty">No saved loot yet</div>
                            </div>
                        </div>
                        </div><!-- /.controls-content -->
                    </div>

                    <!-- Loot Output -->
                    <div class="loot-output">
                        <div id="lootOutput" class="loot-output-inner">
                            <div class="loot-empty-state">
                                <div class="icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 6v6l4 2"></path>
                                        <text x="12" y="16" text-anchor="middle" font-size="8" fill="currentColor" stroke="none">GP</text>
                                    </svg>
                                </div>
                                <h3>No Loot Generated</h3>
                                <p>Choose a hoard type and click "Generate Loot" to create treasure</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== HOOKS GENERATOR PANEL ==================== -->
            <div id="panel-hooks" class="generator-panel">
                <div class="hook-panel-layout">
                    <!-- Hook Controls -->
                    <div class="hook-controls">
                        <header class="controls-header" id="hook-panel-toggle">
                            <h2>Hook Generator</h2>
                            <span class="toggle-indicator">&#9660;</span>
                        </header>
                        <div class="controls-content" id="hook-panel-content">
                        <div class="hook-control-group">
                            <label for="hookBiome">Biome</label>
                            <select id="hookBiome">
                                <option value="random">Random</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="hook-control-group">
                            <label for="hookMonsterType">Monster Type</label>
                            <select id="hookMonsterType">
                                <option value="random">Random</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="hook-control-group">
                            <label for="hookTheme">Encounter Theme</label>
                            <select id="hookTheme">
                                <option value="random">Random</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="hook-control-group">
                            <label for="hookQuantity">Quantity</label>
                            <input type="number" id="hookQuantity" min="1" max="15" value="5">
                            <div class="hook-quantity-hint">Generate 1-15 hooks per batch</div>
                        </div>

                        <button type="button" class="hook-generate-btn" onclick="HookPanel.generate()">
                            Generate Hooks
                        </button>

                        <div class="hook-options">
                            <label class="hook-option">
                                <input type="checkbox" id="hookShowEnvironment" checked onchange="HookPanel.updateOptions()">
                                <span>Show environmental hazards</span>
                            </label>
                            <label class="hook-option">
                                <input type="checkbox" id="hookShowLoot" checked onchange="HookPanel.updateOptions()">
                                <span>Show loot teasers</span>
                            </label>
                            <label class="hook-option">
                                <input type="checkbox" id="hookShowMoral" checked onchange="HookPanel.updateOptions()">
                                <span>Show moral dilemmas</span>
                            </label>
                        </div>

                        <!-- Saved Hooks Library -->
                        <div class="hook-library-section">
                            <h3>Saved Hooks</h3>
                            <div id="hookLibraryList" class="hook-library-list">
                                <div class="hook-library-empty">No saved hooks yet</div>
                            </div>
                        </div>
                        </div><!-- /.controls-content -->
                    </div>

                    <!-- Hook Output -->
                    <div class="hook-output">
                        <div id="hookOutput" class="hook-output-inner">
                            <div class="hook-empty-state">
                                <div class="icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                </div>
                                <h3>No Hooks Generated</h3>
                                <p>Choose your settings and click "Generate Hooks" to create quest seeds</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== LOCATION GENERATOR PANEL ==================== -->
            <div id="panel-location" class="generator-panel">
                <div class="location-panel-layout">
                    <!-- Location Controls -->
                    <div class="location-controls">
                        <header class="controls-header" id="location-panel-toggle">
                            <h2>Location Generator</h2>
                            <span class="toggle-indicator">&#9660;</span>
                        </header>
                        <div class="controls-content" id="location-panel-content">
                        <div class="location-control-group">
                            <label for="locationScale">Scale</label>
                            <select id="locationScale">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <!-- Settlement subtype -->
                        <div id="settlementSubtype" class="location-subtype-group" style="display: none;">
                            <label for="locationSettlementScale">Settlement Size</label>
                            <select id="locationSettlementScale">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <!-- District subtype -->
                        <div id="districtSubtype" class="location-subtype-group" style="display: none;">
                            <label for="locationDistrictType">District Type</label>
                            <select id="locationDistrictType">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <!-- Shop subtype -->
                        <div id="shopSubtype" class="location-subtype-group">
                            <label for="locationShopType">Shop Type</label>
                            <select id="locationShopType">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <!-- Landmark subtype -->
                        <div id="landmarkSubtype" class="location-subtype-group" style="display: none;">
                            <label for="locationLandmarkScale">Landmark Scale</label>
                            <select id="locationLandmarkScale">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <!-- Biome (for wilderness) -->
                        <div id="biomeGroup" class="location-control-group" style="display: none;">
                            <label for="locationBiome">Biome</label>
                            <select id="locationBiome">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="location-control-group">
                            <label for="locationWealth">Wealth Tier</label>
                            <select id="locationWealth">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="location-control-group">
                            <label for="locationQuantity">Quantity</label>
                            <input type="number" id="locationQuantity" min="1" max="15" value="1">
                        </div>

                        <button type="button" class="location-generate-btn" onclick="LocationPanel.generate()">
                            Generate Locations
                        </button>

                        <!-- Saved Locations Library -->
                        <div class="location-library-section">
                            <h3>Saved Locations</h3>
                            <div id="locationLibraryList" class="location-library-list">
                                <div class="location-library-empty">No saved locations yet</div>
                            </div>
                        </div>
                        </div><!-- /.controls-content -->
                    </div>

                    <!-- Location Output -->
                    <div class="location-output">
                        <div id="locationOutput" class="location-output-inner">
                            <div class="location-empty-state">
                                <div class="icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                    </svg>
                                </div>
                                <h3>No Locations Generated</h3>
                                <p>Choose a scale and click "Generate Locations" to create places</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== ITEM GENERATOR PANEL ==================== -->
            <div id="panel-item" class="generator-panel">
                <div class="item-panel-layout">
                    <!-- Item Controls -->
                    <div class="item-controls">
                        <header class="controls-header" id="item-panel-toggle">
                            <h2>Item Generator</h2>
                            <span class="toggle-indicator">&#9660;</span>
                        </header>
                        <div class="controls-content" id="item-panel-content">
                        <div class="item-control-group">
                            <label for="itemType">Item Type</label>
                            <select id="itemType">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="item-control-group">
                            <label for="itemSubtype">Subtype</label>
                            <select id="itemSubtype">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="item-control-group">
                            <label for="itemRarity">Rarity</label>
                            <select id="itemRarity">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="item-control-group">
                            <label for="itemBiome">Biome</label>
                            <select id="itemBiome">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="item-control-group">
                            <label for="itemQuantity">Quantity</label>
                            <input type="number" id="itemQuantity" min="1" max="15" value="3">
                        </div>

                        <div class="item-generate-buttons">
                            <button type="button" class="item-btn-generate" onclick="ItemPanel.generate()">
                                Generate Items
                            </button>
                            <button type="button" class="item-btn-secondary" onclick="ItemPanel.generateIncludeAll()">
                                Include All Biomes
                            </button>
                            <button type="button" class="item-btn-secondary" onclick="ItemPanel.generateSurpriseMe()">
                                Surprise Me!
                            </button>
                        </div>

                        <div class="item-action-row">
                            <button type="button" class="item-btn-action" onclick="ItemPanel.saveAll()">Save All</button>
                            <button type="button" class="item-btn-action" onclick="ItemPanel.copyAll()">Copy All</button>
                        </div>

                        <!-- Saved Items Library -->
                        <div class="item-library-section">
                            <div class="item-library-header">
                                <h4>Saved Items</h4>
                            </div>
                            <div id="itemLibraryList" class="item-library-list">
                                <div class="item-library-empty">No saved items yet</div>
                            </div>
                        </div>
                        </div><!-- /.controls-content -->
                    </div>

                    <!-- Item Output -->
                    <div class="item-output">
                        <div id="itemOutput" class="item-output-inner">
                            <div class="item-empty-state">
                                <div class="icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                    </svg>
                                </div>
                                <h3>No Items Generated</h3>
                                <p>Choose your settings and click "Generate Items" to create magic items</p>
                                <p class="subtitle">Try "Surprise Me!" for completely random items</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== LIBRARY PANEL ==================== -->
            <div id="panel-library" class="generator-panel">
                <div class="library-container">
                    <div class="library-header">
                        <h2>Saved Content Library</h2>
                        <p>All your saved monsters, NPCs, loot, and more in one place</p>
                    </div>

                    <div class="library-tabs">
                        <button class="library-tab active" data-type="monsters" onclick="LibraryPanel.switchTab('monsters')">Monsters</button>
                        <button class="library-tab" data-type="npcs" onclick="LibraryPanel.switchTab('npcs')">NPCs</button>
                        <button class="library-tab" data-type="loot" onclick="LibraryPanel.switchTab('loot')">Loot</button>
                        <button class="library-tab" data-type="hooks" onclick="LibraryPanel.switchTab('hooks')">Hooks</button>
                        <button class="library-tab" data-type="locations" onclick="LibraryPanel.switchTab('locations')">Locations</button>
                        <button class="library-tab" data-type="items" onclick="LibraryPanel.switchTab('items')">Items</button>
                    </div>

                    <div class="library-search">
                        <input type="text" id="library-search" placeholder="Search saved content..." oninput="LibraryPanel.search(this.value)">
                    </div>

                    <div class="library-content" id="library-content">
                        <div class="library-empty">
                            <p>Select a category to view saved content</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== CAMPAIGN CANVAS PANEL ==================== -->
            <div id="panel-campaign" class="generator-panel">
                <div class="canvas-container">
                    <!-- Canvas Toolbar -->
                    <div class="canvas-toolbar">
                        <div class="canvas-toolbar-section">
                            <span id="canvas-board-name">My Campaign</span>
                            <select id="canvas-board-select" onchange="CampaignCanvas.loadBoard(this.value)">
                            </select>
                        </div>

                        <div class="canvas-toolbar-divider"></div>

                        <div class="canvas-toolbar-section">
                            <button class="canvas-btn" onclick="CampaignCanvas.createBoard(prompt('Board name:') || 'New Board')">New Board</button>
                            <button class="canvas-btn" onclick="CampaignCanvas.renameBoard()">Rename</button>
                            <button class="canvas-btn canvas-btn-danger" onclick="CampaignCanvas.deleteBoard()">Delete</button>
                        </div>

                        <div class="canvas-toolbar-divider"></div>

                        <div class="canvas-toolbar-section">
                            <button class="canvas-btn canvas-btn-icon" onclick="CampaignCanvas.zoomToFit()" title="Zoom to fit">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                            </button>
                            <button class="canvas-btn canvas-btn-icon" onclick="CampaignCanvas.resetView()" title="Reset view">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                            </button>
                            <button class="canvas-btn canvas-btn-icon mobile-zoom-btn" onclick="CampaignCanvas.zoomIn()" title="Zoom in">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            <button class="canvas-btn canvas-btn-icon mobile-zoom-btn" onclick="CampaignCanvas.zoomOut()" title="Zoom out">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            <span id="canvas-zoom-level">100%</span>
                        </div>

                        <div class="canvas-toolbar-divider"></div>

                        <div class="canvas-toolbar-section">
                            <button class="canvas-btn" onclick="CampaignCanvas.clearBoard()">Clear</button>
                            <button class="canvas-btn" onclick="CampaignCanvas.exportBoard()">Export</button>
                            <input type="file" id="canvas-import-file" accept=".json" style="display:none" onchange="CampaignCanvas.importBoard(this.files[0])">
                            <button class="canvas-btn" onclick="document.getElementById('canvas-import-file').click()">Import</button>
                        </div>

                        <div class="canvas-toolbar-divider"></div>

                        <div class="canvas-toolbar-section">
                            <button class="canvas-btn canvas-btn-primary" onclick="CanvasLibrary.toggle()" id="canvas-library-toggle">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px; vertical-align: middle;">
                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                                </svg>
                                Library
                            </button>
                        </div>
                    </div>

                    <!-- Library Drawer -->
                    <div id="canvas-library-drawer" class="canvas-library-drawer">
                        <div class="canvas-library-header">
                            <h3>Saved Items</h3>
                            <button class="canvas-library-close" onclick="CanvasLibrary.close()">&times;</button>
                        </div>
                        <div class="canvas-library-tabs">
                            <button class="canvas-library-tab active" data-type="monster" onclick="CanvasLibrary.switchTab('monster')">Monsters</button>
                            <button class="canvas-library-tab" data-type="npc" onclick="CanvasLibrary.switchTab('npc')">NPCs</button>
                            <button class="canvas-library-tab" data-type="loot" onclick="CanvasLibrary.switchTab('loot')">Loot</button>
                            <button class="canvas-library-tab" data-type="hook" onclick="CanvasLibrary.switchTab('hook')">Hooks</button>
                            <button class="canvas-library-tab" data-type="location" onclick="CanvasLibrary.switchTab('location')">Locations</button>
                            <button class="canvas-library-tab" data-type="item" onclick="CanvasLibrary.switchTab('item')">Items</button>
                        </div>
                        <div class="canvas-library-search">
                            <input type="text" id="canvas-library-search" placeholder="Search..." oninput="CanvasLibrary.filter(this.value)">
                        </div>
                        <div id="canvas-library-content" class="canvas-library-content">
                            <!-- Items will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Main Canvas -->
                    <div id="campaign-canvas">
                        <svg id="canvas-svg-layer"></svg>
                        <div id="canvas-viewport"></div>
                        <div class="canvas-empty-state" id="canvas-empty-state">
                            <div class="icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="3" y1="9" x2="21" y2="9"></line>
                                    <line x1="9" y1="21" x2="9" y2="9"></line>
                                </svg>
                            </div>
                            <h3>Campaign Canvas</h3>
                            <p>Drag to pan, scroll to zoom. Right-click to add notes.<br>
                            Use "Send to Canvas" from any generator to add cards here.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== VTT BATTLEMAP MANAGER PANEL ==================== -->
            <div id="panel-vtt" class="generator-panel">
                <div class="vtt-container">
                    <!-- VTT Toolbar -->
                    <div class="vtt-toolbar">
                        <div class="vtt-toolbar-section">
                            <span class="vtt-title">Battlemap Manager</span>
                            <select id="vtt-map-select" onchange="VTTManager.loadMap(this.value)">
                            </select>
                        </div>

                        <div class="vtt-toolbar-divider"></div>

                        <div class="vtt-toolbar-section">
                            <button class="vtt-btn" onclick="VTTManager.createMap(prompt('Map name:') || 'New Map')">New Map</button>
                            <button class="vtt-btn" onclick="VTTManager.renameMap()">Rename</button>
                            <button class="vtt-btn vtt-btn-danger" onclick="VTTManager.deleteMap()">Delete</button>
                        </div>

                        <div class="vtt-toolbar-divider"></div>

                        <div class="vtt-toolbar-section vtt-tools">
                            <button class="vtt-btn vtt-tool-btn active" data-tool="select" onclick="VTTManager.setTool('select')" title="Select">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path>
                                </svg>
                            </button>
                            <button class="vtt-btn vtt-tool-btn" data-tool="fog" onclick="VTTManager.setTool('fog')" title="Fog of War">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9z"></path>
                                </svg>
                            </button>
                            <button class="vtt-btn vtt-tool-btn" data-tool="eraser" onclick="VTTManager.setTool('eraser')" title="Fog Eraser">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 20H7L3 16l11-11 6 6-4 4"></path>
                                    <path d="M17 11l-5-5"></path>
                                </svg>
                            </button>
                            <button class="vtt-btn vtt-tool-btn" data-tool="ruler" onclick="VTTManager.setTool('ruler')" title="Measure Distance">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21.3 8.7L8.7 21.3c-.4.4-1 .4-1.4 0L2.7 16.7c-.4-.4-.4-1 0-1.4L15.3 2.7c.4-.4 1-.4 1.4 0l4.6 4.6c.4.4.4 1 0 1.4z"></path>
                                    <path d="M9 12l2-2"></path>
                                    <path d="M6 15l2-2"></path>
                                    <path d="M12 9l2-2"></path>
                                </svg>
                            </button>
                        </div>

                        <div class="vtt-toolbar-divider"></div>

                        <div class="vtt-toolbar-section">
                            <button class="vtt-btn vtt-btn-icon" onclick="VTTManager.zoomIn()" title="Zoom In">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    <line x1="11" y1="8" x2="11" y2="14"></line>
                                    <line x1="8" y1="11" x2="14" y2="11"></line>
                                </svg>
                            </button>
                            <button class="vtt-btn vtt-btn-icon" onclick="VTTManager.zoomOut()" title="Zoom Out">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    <line x1="8" y1="11" x2="14" y2="11"></line>
                                </svg>
                            </button>
                            <button class="vtt-btn vtt-btn-icon" onclick="VTTManager.resetView()" title="Reset View">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                </svg>
                            </button>
                            <span id="vtt-zoom-level">100%</span>
                        </div>

                        <div class="vtt-toolbar-divider"></div>

                        <div class="vtt-toolbar-section">
                            <button class="vtt-btn" onclick="VTTManager.exportMap()">Export</button>
                            <input type="file" id="vtt-import-file" accept=".json" style="display:none" onchange="VTTManager.importMap(this.files[0])">
                            <button class="vtt-btn" onclick="document.getElementById('vtt-import-file').click()">Import</button>
                        </div>

                        <div class="vtt-toolbar-divider"></div>

                        <div class="vtt-toolbar-section">
                            <button class="vtt-btn vtt-btn-primary" onclick="VTTManager.toggleSidebar('tokens')" id="vtt-tokens-toggle">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px; vertical-align: middle;">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                Tokens
                            </button>
                            <button class="vtt-btn" onclick="VTTManager.toggleSidebar('initiative')" id="vtt-initiative-toggle">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px; vertical-align: middle;">
                                    <path d="M12 2v20"></path>
                                    <path d="M2 12h20"></path>
                                </svg>
                                Initiative
                            </button>
                        </div>
                    </div>

                    <!-- Token/Monster Sidebar -->
                    <div id="vtt-sidebar" class="vtt-sidebar">
                        <!-- Tokens Panel -->
                        <div id="vtt-tokens-panel" class="vtt-sidebar-panel active">
                            <div class="vtt-sidebar-header">
                                <h3>Tokens</h3>
                                <button class="vtt-sidebar-close" onclick="VTTManager.closeSidebar()">&times;</button>
                            </div>

                            <div class="vtt-token-section">
                                <h4>Add Player Token</h4>
                                <div class="vtt-add-player-row">
                                    <select id="vtt-player-color" class="vtt-player-color-select">
                                        <option value="blue">Blue</option>
                                        <option value="green">Green</option>
                                        <option value="red">Red</option>
                                        <option value="yellow">Yellow</option>
                                        <option value="purple">Purple</option>
                                        <option value="orange">Orange</option>
                                    </select>
                                    <button class="vtt-btn vtt-btn-primary" onclick="VTTManager.addPlayerToken(document.getElementById('vtt-player-color').value)">
                                        Add Token
                                    </button>
                                </div>
                            </div>

                            <div class="vtt-token-section">
                                <h4>Saved Tokens</h4>
                                <div id="vtt-saved-tokens-list" class="vtt-saved-tokens-list">
                                    <div class="vtt-empty-state">No saved tokens yet.<br>Right-click a token to save it.</div>
                                </div>
                            </div>

                            <div class="vtt-token-section">
                                <h4>Monster Library</h4>
                                <div class="vtt-monster-search">
                                    <input type="text" id="vtt-monster-search" placeholder="Search saved monsters..." oninput="VTTManager.filterMonsters(this.value)">
                                </div>
                                <div class="vtt-monster-favorites">
                                    <h5>Favorites</h5>
                                    <div id="vtt-monster-favorites-list" class="vtt-monster-list">
                                        <div class="vtt-empty-state">No favorites yet</div>
                                    </div>
                                </div>
                                <div class="vtt-monster-all">
                                    <h5>All Monsters</h5>
                                    <div id="vtt-monster-list" class="vtt-monster-list">
                                        <div class="vtt-empty-state">No saved monsters</div>
                                    </div>
                                </div>
                            </div>

                            <div class="vtt-token-section">
                                <h4>Token Settings</h4>
                                <div class="vtt-token-settings">
                                    <label class="vtt-setting">
                                        <input type="checkbox" id="vtt-show-hp" checked onchange="VTTManager.updateSettings()">
                                        <span>Show HP Bars</span>
                                    </label>
                                    <label class="vtt-setting">
                                        <input type="checkbox" id="vtt-show-ac" checked onchange="VTTManager.updateSettings()">
                                        <span>Show AC Bubbles</span>
                                    </label>
                                    <label class="vtt-setting">
                                        <input type="checkbox" id="vtt-show-conditions" checked onchange="VTTManager.updateSettings()">
                                        <span>Show Conditions</span>
                                    </label>
                                </div>
                            </div>

                            <div class="vtt-token-section">
                                <button class="vtt-btn vtt-btn-danger" style="width: 100%;" onclick="VTTManager.clearAllTokens()">
                                    Clear All Tokens
                                </button>
                            </div>
                        </div>

                        <!-- Initiative Panel -->
                        <div id="vtt-initiative-panel" class="vtt-sidebar-panel">
                            <div class="vtt-sidebar-header">
                                <h3>Initiative Tracker</h3>
                                <button class="vtt-sidebar-close" onclick="VTTManager.closeSidebar()">&times;</button>
                            </div>

                            <div class="vtt-initiative-controls">
                                <button class="vtt-btn vtt-btn-sm" onclick="VTTManager.prevTurn()">&lt; Prev</button>
                                <span class="vtt-round-counter">Round <span id="vtt-round">1</span></span>
                                <button class="vtt-btn vtt-btn-sm vtt-btn-primary" onclick="VTTManager.nextTurn()">Next &gt;</button>
                            </div>

                            <div id="vtt-initiative-list" class="vtt-initiative-list">
                                <div class="vtt-empty-state">No tokens on map</div>
                            </div>

                            <div class="vtt-initiative-actions">
                                <button class="vtt-btn" onclick="VTTManager.rollAllInitiative()">Roll All</button>
                                <button class="vtt-btn" onclick="VTTManager.sortInitiative()">Sort</button>
                                <button class="vtt-btn vtt-btn-danger" onclick="VTTManager.clearInitiative()">Clear</button>
                            </div>
                        </div>
                    </div>

                    <!-- Grid Settings Panel (Bottom) -->
                    <div class="vtt-grid-settings">
                        <div class="vtt-grid-control">
                            <label>Grid Size</label>
                            <input type="range" id="vtt-grid-size" min="20" max="100" value="50" oninput="VTTManager.updateGridSize(this.value)">
                            <span id="vtt-grid-size-value">50px</span>
                        </div>
                        <div class="vtt-grid-control">
                            <label>Grid Opacity</label>
                            <input type="range" id="vtt-grid-opacity" min="0" max="100" value="30" oninput="VTTManager.updateGridOpacity(this.value)">
                            <span id="vtt-grid-opacity-value">30%</span>
                        </div>
                        <div class="vtt-grid-control">
                            <label>Background</label>
                            <input type="file" id="vtt-bg-upload" accept="image/*" style="display:none" onchange="VTTManager.uploadBackground(this.files[0])">
                            <button class="vtt-btn vtt-btn-sm" onclick="document.getElementById('vtt-bg-upload').click()">Upload Map</button>
                            <button class="vtt-btn vtt-btn-sm" onclick="VTTManager.clearBackground()">Clear</button>
                        </div>
                    </div>

                    <!-- Main VTT Canvas -->
                    <div id="vtt-canvas" class="vtt-canvas">
                        <div id="vtt-grid-layer" class="vtt-grid-layer"></div>
                        <div id="vtt-background-layer" class="vtt-background-layer"></div>
                        <div id="vtt-token-layer" class="vtt-token-layer"></div>
                        <div id="vtt-fog-layer" class="vtt-fog-layer"></div>
                        <svg id="vtt-measure-layer" class="vtt-measure-layer"></svg>
                    </div>

                    <!-- Ruler Measurement Display -->
                    <div id="vtt-ruler-display" class="vtt-ruler-display hidden">
                        <span id="vtt-ruler-distance">0 ft</span>
                    </div>

                    <!-- Mobile Action Bar -->
                    <div class="vtt-mobile-actions">
                        <button class="vtt-btn" onclick="VTTManager.createMap(prompt('Map name:') || 'New Map')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            New
                        </button>
                        <button class="vtt-btn" onclick="VTTManager.renameMap()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Rename
                        </button>
                        <button class="vtt-btn vtt-btn-danger" onclick="VTTManager.deleteMap()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                            Delete
                        </button>
                        <button class="vtt-btn" onclick="document.getElementById('vtt-bg-upload').click()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            Map
                        </button>
                        <button class="vtt-btn vtt-btn-primary" onclick="VTTManager.toggleSidebar('tokens')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                            </svg>
                            Tokens
                        </button>
                    </div>

                    <!-- Dice Roller Bubble -->
                    <div id="vtt-dice-roller" class="vtt-dice-roller">
                        <button class="vtt-dice-toggle" onclick="VTTManager.toggleDiceRoller()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                        </button>
                        <div id="vtt-dice-panel" class="vtt-dice-panel">
                            <h4>Dice Roller</h4>
                            <div class="vtt-dice-grid">
                                <button class="vtt-dice-btn" data-die="4" onclick="VTTManager.selectDie(4)">d4</button>
                                <button class="vtt-dice-btn" data-die="6" onclick="VTTManager.selectDie(6)">d6</button>
                                <button class="vtt-dice-btn" data-die="8" onclick="VTTManager.selectDie(8)">d8</button>
                                <button class="vtt-dice-btn" data-die="10" onclick="VTTManager.selectDie(10)">d10</button>
                                <button class="vtt-dice-btn" data-die="12" onclick="VTTManager.selectDie(12)">d12</button>
                                <button class="vtt-dice-btn active" data-die="20" onclick="VTTManager.selectDie(20)">d20</button>
                                <button class="vtt-dice-btn" data-die="100" onclick="VTTManager.selectDie(100)">d100</button>
                            </div>
                            <div class="vtt-dice-count">
                                <button onclick="VTTManager.changeDiceCount(-1)">-</button>
                                <span id="vtt-dice-count-display">1d20</span>
                                <button onclick="VTTManager.changeDiceCount(1)">+</button>
                            </div>
                            <button class="vtt-roll-btn" onclick="VTTManager.rollDice()">Roll!</button>
                            <div id="vtt-roll-result" class="vtt-roll-result">
                                <div id="vtt-roll-total" class="vtt-roll-total">0</div>
                                <div id="vtt-roll-breakdown" class="vtt-roll-breakdown"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monster Library Modal -->
    <div id="library-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Monster Library</h2>
                <button type="button" id="close-library-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-toolbar">
                <input type="text" id="library-search" placeholder="Search monsters...">
                <select id="library-filter-type">
                    <option value="">All Types</option>
                    <option value="aberration">Aberration</option>
                    <option value="beast">Beast</option>
                    <option value="celestial">Celestial</option>
                    <option value="construct">Construct</option>
                    <option value="dragon">Dragon</option>
                    <option value="elemental">Elemental</option>
                    <option value="fey">Fey</option>
                    <option value="fiend">Fiend</option>
                    <option value="giant">Giant</option>
                    <option value="humanoid">Humanoid</option>
                    <option value="monstrosity">Monstrosity</option>
                    <option value="ooze">Ooze</option>
                    <option value="plant">Plant</option>
                    <option value="undead">Undead</option>
                </select>
                <select id="library-sort">
                    <option value="name">Sort by Name</option>
                    <option value="cr">Sort by CR</option>
                    <option value="type">Sort by Type</option>
                    <option value="date">Sort by Date</option>
                </select>
            </div>
            <div class="modal-body">
                <div id="library-list" class="library-list">
                    <p class="library-empty">No saved monsters yet. Generate and save some!</p>
                </div>
            </div>
            <div class="modal-footer">
                <input type="file" id="import-file" accept=".json" style="display: none;">
                <button type="button" id="import-btn" class="btn btn-secondary">
                    Import JSON
                </button>
                <button type="button" id="export-library-btn" class="btn btn-secondary">
                    Export All
                </button>
                <span id="library-count" class="library-count">0 monsters saved</span>
            </div>
        </div>
    </div>

    <!-- Edit Monster Modal -->
    <div id="edit-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-edit">
            <div class="modal-header">
                <h2>Edit Monster</h2>
                <button type="button" id="close-edit-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body edit-form">
                <div class="edit-section">
                    <h3>Basic Info</h3>
                    <div class="edit-row">
                        <label for="edit-name">Name</label>
                        <input type="text" id="edit-name">
                    </div>
                    <div class="edit-row">
                        <label for="edit-size">Size</label>
                        <select id="edit-size">
                            <option value="tiny">Tiny</option>
                            <option value="small">Small</option>
                            <option value="medium">Medium</option>
                            <option value="large">Large</option>
                            <option value="huge">Huge</option>
                            <option value="gargantuan">Gargantuan</option>
                        </select>
                    </div>
                    <div class="edit-row">
                        <label for="edit-alignment">Alignment</label>
                        <input type="text" id="edit-alignment">
                    </div>
                </div>

                <div class="edit-section">
                    <h3>Combat Stats</h3>
                    <div class="edit-row-group">
                        <div class="edit-row">
                            <label for="edit-ac">AC</label>
                            <input type="number" id="edit-ac" min="1" max="30">
                        </div>
                        <div class="edit-row">
                            <label for="edit-ac-type">AC Type</label>
                            <input type="text" id="edit-ac-type" placeholder="natural armor">
                        </div>
                    </div>
                    <div class="edit-row-group">
                        <div class="edit-row">
                            <label for="edit-hp-avg">HP Average</label>
                            <input type="number" id="edit-hp-avg" min="1">
                        </div>
                        <div class="edit-row">
                            <label for="edit-hp-dice">HP Dice</label>
                            <input type="text" id="edit-hp-dice" placeholder="10d8+20">
                        </div>
                    </div>
                    <div class="edit-row">
                        <label for="edit-speed">Speed</label>
                        <input type="text" id="edit-speed" placeholder="30 ft., fly 60 ft.">
                    </div>
                </div>

                <div class="edit-section">
                    <h3>Ability Scores</h3>
                    <div class="edit-abilities">
                        <div class="edit-ability">
                            <label for="edit-str">STR</label>
                            <input type="number" id="edit-str" min="1" max="30">
                        </div>
                        <div class="edit-ability">
                            <label for="edit-dex">DEX</label>
                            <input type="number" id="edit-dex" min="1" max="30">
                        </div>
                        <div class="edit-ability">
                            <label for="edit-con">CON</label>
                            <input type="number" id="edit-con" min="1" max="30">
                        </div>
                        <div class="edit-ability">
                            <label for="edit-int">INT</label>
                            <input type="number" id="edit-int" min="1" max="30">
                        </div>
                        <div class="edit-ability">
                            <label for="edit-wis">WIS</label>
                            <input type="number" id="edit-wis" min="1" max="30">
                        </div>
                        <div class="edit-ability">
                            <label for="edit-cha">CHA</label>
                            <input type="number" id="edit-cha" min="1" max="30">
                        </div>
                    </div>
                </div>

                <div class="edit-section">
                    <h3>Defenses</h3>
                    <div class="edit-row">
                        <label for="edit-saves">Saving Throws</label>
                        <input type="text" id="edit-saves" placeholder="Con +5, Wis +3">
                    </div>
                    <div class="edit-row">
                        <label for="edit-skills">Skills</label>
                        <input type="text" id="edit-skills" placeholder="Perception +5, Stealth +4">
                    </div>
                    <div class="edit-row">
                        <label for="edit-resistances">Damage Resistances</label>
                        <input type="text" id="edit-resistances" placeholder="fire, cold">
                    </div>
                    <div class="edit-row">
                        <label for="edit-immunities">Damage Immunities</label>
                        <input type="text" id="edit-immunities" placeholder="poison, psychic">
                    </div>
                    <div class="edit-row">
                        <label for="edit-condition-immunities">Condition Immunities</label>
                        <input type="text" id="edit-condition-immunities" placeholder="poisoned, frightened">
                    </div>
                </div>

                <div class="edit-section">
                    <h3>Senses & Languages</h3>
                    <div class="edit-row">
                        <label for="edit-senses">Senses</label>
                        <input type="text" id="edit-senses" placeholder="darkvision 60 ft., passive Perception 15">
                    </div>
                    <div class="edit-row">
                        <label for="edit-languages">Languages</label>
                        <input type="text" id="edit-languages" placeholder="Common, Draconic">
                    </div>
                </div>

                <div class="edit-section">
                    <h3>Traits</h3>
                    <div id="edit-traits-container" class="edit-list-container">
                        <!-- Traits will be populated dynamically -->
                    </div>
                    <button type="button" id="add-trait-btn" class="btn btn-small">+ Add Trait</button>
                </div>

                <div class="edit-section">
                    <h3>Actions</h3>
                    <div id="edit-actions-container" class="edit-list-container">
                        <!-- Actions will be populated dynamically -->
                    </div>
                    <button type="button" id="add-action-btn" class="btn btn-small">+ Add Action</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancel-edit-btn" class="btn btn-secondary">Cancel</button>
                <button type="button" id="save-edit-btn" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Delete Monster</h2>
                <button type="button" id="close-delete-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="delete-monster-name"></strong>?</p>
                <p class="warning-text">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancel-delete-btn" class="btn btn-secondary">Cancel</button>
                <button type="button" id="confirm-delete-btn" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Load utilities first -->
    <script src="js/utils.js"></script>
    <!-- Data files -->
    <script src="data/monster-types.js"></script>
    <script src="data/attacks.js"></script>
    <script src="data/abilities.js"></script>
    <script src="data/legendary.js"></script>
    <script src="data/spells.js"></script>
    <script src="data/races.js"></script>
    <script src="data/names/monster-names.js"></script>
    <script src="data/names/humanoid-names.js"></script>
    <script src="data/classes.js"></script>
    <script src="data/inventory.js"></script>
    <script src="data/magic-items.js"></script>
    <!-- Application files -->
    <script src="js/generator.js"></script>
    <script src="js/statblock.js"></script>
    <script src="js/export.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/sidebar.js"></script>

    <!-- NPC Generator -->
    <script src="data/npc/races.js"></script>
    <script src="data/npc/shared.js"></script>
    <script src="data/npc/vocations.js"></script>
    <script src="data/npc/traits.js"></script>
    <script src="js/generators/npc.js"></script>
    <script src="js/renderers/npc-card.js"></script>
    <script src="js/npc-panel.js"></script>

    <!-- Loot Generator -->
    <script src="data/loot/treasure-tables.js"></script>
    <script src="data/loot/mundane-items.js"></script>
    <script src="data/loot/consumables.js"></script>
    <script src="data/loot/magic-items-loot.js"></script>
    <script src="js/generators/loot.js"></script>
    <script src="js/renderers/loot-card.js"></script>
    <script src="js/loot-panel.js"></script>

    <!-- Hook Generator -->
    <script src="data/hooks/biomes.js"></script>
    <script src="data/hooks/components.js"></script>
    <script src="data/hooks/themes.js"></script>
    <script src="js/generators/hooks.js"></script>
    <script src="js/renderers/hook-card.js"></script>
    <script src="js/hook-panel.js"></script>

    <!-- Location Generator -->
    <script src="data/locations/settlements.js"></script>
    <script src="data/locations/shops.js"></script>
    <script src="data/locations/landmarks.js"></script>
    <script src="data/locations/names.js"></script>
    <script src="js/generators/location.js"></script>
    <script src="js/renderers/location-card.js"></script>
    <script src="js/location-panel.js"></script>

    <!-- Item Generator -->
    <script src="data/items/types.js"></script>
    <script src="data/items/biomes.js"></script>
    <script src="data/items/effects.js"></script>
    <script src="data/items/names.js"></script>
    <script src="js/generators/item.js"></script>
    <script src="js/renderers/item-card.js"></script>
    <script src="js/item-panel.js"></script>

    <!-- Library Panel -->
    <script src="js/library.js"></script>

    <!-- Campaign Canvas -->
    <script src="js/canvas.js"></script>
    <script src="js/canvas-cards.js"></script>
    <script src="js/canvas-connections.js"></script>
    <script src="js/canvas-library.js"></script>

    <!-- VTT Battlemap Manager -->
    <script src="js/vtt.js"></script>

    <script src="js/app.js"></script>
</body>
</html>
